<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>stick/middleware/csrf - Stick API</title>

        <link rel="shortcut icon" href="http://ringojs.org/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="http://ringojs.org/favicon.ico" type="image/x-icon" />
        <link href='http://fonts.googleapis.com/css?family=Fira+Mono:400,700|Open+Sans:400italic,700italic,700,400,600' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../../static/jsdoc.css" />
<link rel="stylesheet" href="../../static/style.css" />
<script type="text/javascript" src="../../static/jquery.min.js"></script>
<script type="text/javascript" src="../../static/jsdoc.js"></script>


  </head>

  <body class="jsdoc standalone">
    <div class="main">
        <div class="content jsdoc">
        
            <h1 class="modulename">Module stick/middleware/csrf</h1>
        <div class="fileoverview">
            <p>A middleware for CSRF mitigation, using either the
synchronizer token or the double submission cookie pattern (see
<a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet">OWASP CSRF Prevention Cheat Sheet</a>
for a detailed explanation).</p>

This middleware extends the request object by adding two methods:
<ul><li><code>getCsrfToken()</code> returns the CSRF token value for the current request,
creating and storing it in the current session if necessary</li>
<li><code>rotateCsrfToken()</code> creates a new CSRF token and stores it in the current session</li></ul>

<p>Use <code>getCsrfToken()</code> of the request object to add the token value as
hidden input to all forms generated by the application, and make sure the
name of the form input is configured accordingly (defaults to "csrftoken").</p>

<p>The token value returned by <code>getCsrfToken()</code> is additionally stored either
in the current session (default) or in a cookie. The POST parameter and
the token value stored are compared, and in case of a mismatch this
middleware returns a 403 "Forbidden" response.</p>

<p>For non-POST requests this middleware accepts the token sent as query
parameter or custom header field.</p>

<h3>Configuration options:</h3>

<p><code>app.csrf()</code> accepts an object as parameter containing the following
properties (default values in brackets):</p>

<ul><li><code>tokenLength</code>: The length of the CSRF token (32)</li>
<li><code>checkReferrer</code>: Enable strict referrer checking for HTTPS requests (true)</li>
<li><code>rotate</code>: If true tokens are only used once and modified after each validation (false)</li>
<li><code>getToken</code>: By default the middleware expects the submitted CSRF token in
either a post or query parameter <code>csrftoken</code> or in a custom request header
<code>x-csrf-token</code> (in this order). To customize this define a function
that will receive the request object as single argument and is expected
to return the CSRF token (or null).</li>
<li><code>getFailureResponse</code>: An optional function receiving the request as single argument.
This method is called if the CSRF validation failed, and is expected to return
a valid JSGI response (default: 403 forbidden).</li>
<li><code>safeMethods</code>: An array containing request method names that are
considered safe, so no token validation is done (["GET", "HEAD", "OPTIONS", "TRACE"])</li></ul>

<h4>Cookie mode</h4>

<p>The following options switch the middleware into "double submission cookie" mode,
and allow detailed configuration of the cookie:</p>

<ul><li><code>useCookie</code>: If true the CSRF token is stored in a cookie</li>
<li><code>cookieName</code>: The name of the cookie to set ("csrftoken")</li>
<li><code>cookieHttpOnly</code>: If true the <code>httpOnly</code> flag of the cookie is set (true)</li>
<li><code>cookieSecure</code>: If true the <code>secure</code> flag of the cookie is set (false)</li></ul>


        </div>

                <div>
            <h4> Example </h4>
            <pre class="sh_javascript sh_sourceCode">app.configure("csrf");
app.csrf({
    "tokenLength": 64,
    "rotate": true,
    "getToken": function(req) {
        return req.headers["x-custom-field"];
    }
});</pre>
        </div>
        <div class="classoverview">

                        <h2 class="functions">Functions</h2>
            <ul class="functions propertyoverview">
                                <li>
                    <a href="#middleware" class="jsdoc-title"> middleware</a>(next, app)
                </li>
                </ul>
            <div class="classes">
                </div>
        </div>
        <div class="details">
                        <hr />
            <!-- tpl-docitem -->
            <div class="docitem" data-docitem="middleware">
                <h3 >
                    <span class="itemtitle"><a id="middleware" href="#middleware" class="itemtitle itemname">middleware</a></span>
                    <span class="itemtitle light">(next, app)</span></h3>
                <div>
                    <p>Stick middleware factory for CSRF mitigation</p>


                </div>
                                <div>
                    <h4>Parameters</h4>
                    <table>
                                                <tr>
                            <td>Function</td>
                            <td class="paramname">next</td>
                            <td>the wrapped middleware chain</td>
                        </tr>
                                                <tr>
                            <td>Object</td>
                            <td class="paramname">app</td>
                            <td>the Stick Application object</td>
                        </tr>
                        </table>
                </div>
                                <div>
                    <h4>Returns</h4>
                    <table>
                        <tr>
                            <td>Function</td>
                            <td> a JSGI middleware function</td>
                        </tr>
                    </table>
                </div>
                </div>
            </div>
    
        </div>

        <nav class="jsdoc standalone">
            <h1>Stick API</h1>
            <div class="jsdocSidenav">
   <div class="toggles">
      <a href="../../index.html">&bull; Modules</a>
      <a href="../../index_all.html">&bull; Overview</a>
   </div>

   <input id="filter" type="text" placeholder="Filter modules" />

   <ul id="modulelist">
            <li><a href="../../stick/index.html">stick</a></li>
            <li><a href="../../helpers/index.html">stick/helpers</a></li>
            <li><a href="../../middleware/index.html">stick/middleware</a></li>
            <li><a href="../../middleware/accept/index.html">stick/middleware/accept</a></li>
            <li><a href="../../middleware/basicauth/index.html">stick/middleware/basicauth</a></li>
            <li><a href="../../middleware/continuation/index.html">stick/middleware/continuation</a></li>
            <li><a href="../../middleware/cookies/index.html">stick/middleware/cookies</a></li>
            <li><a href="../../middleware/cors/index.html">stick/middleware/cors</a></li>
            <li><a href="../../middleware/csrf/index.html">stick/middleware/csrf</a></li>
            <li><a href="../../middleware/error/index.html">stick/middleware/error</a></li>
            <li><a href="../../middleware/etag/index.html">stick/middleware/etag</a></li>
            <li><a href="../../middleware/gzip/index.html">stick/middleware/gzip</a></li>
            <li><a href="../../middleware/method/index.html">stick/middleware/method</a></li>
            <li><a href="../../middleware/mount/index.html">stick/middleware/mount</a></li>
            <li><a href="../../middleware/notfound/index.html">stick/middleware/notfound</a></li>
            <li><a href="../../middleware/params/index.html">stick/middleware/params</a></li>
            <li><a href="../../middleware/profiler/index.html">stick/middleware/profiler</a></li>
            <li><a href="../../middleware/render/index.html">stick/middleware/render</a></li>
            <li><a href="../../middleware/requestlog/index.html">stick/middleware/requestlog</a></li>
            <li><a href="../../middleware/route/index.html">stick/middleware/route</a></li>
            <li><a href="../../middleware/session/index.html">stick/middleware/session</a></li>
            <li><a href="../../middleware/static/index.html">stick/middleware/static</a></li>
            <li><a href="../../middleware/upload/index.html">stick/middleware/upload</a></li>
      </ul>
</div>

        </nav>
    </div>
    </body>
</html>
